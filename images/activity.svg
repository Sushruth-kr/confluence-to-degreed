<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1145px" preserveAspectRatio="none" style="width:1589px;height:1145px;" version="1.1" viewBox="0 0 1589 1145" width="1589px" zoomAndPan="magnify"><defs><filter height="300%" id="fcmp4j0j1breg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="432" cy="18" fill="#000000" filter="url(#fcmp4j0j1breg)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="172" x="346" y="69"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="152" x="356" y="90.1387">Cloudwatch Timed Event</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="256" x="304" y="144"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="236" x="314" y="165.1387">Confluence to Degreed Step Function</text><rect fill="#DE9C0D" filter="url(#fcmp4j0j1breg)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="566" y="219"/><path d="M580.5,148.5 L580.5,173.6328 A0,0 0 0 0 580.5,173.6328 L648.817,173.6328 L609.108,218.785 L656.817,173.6328 L747.5,173.6328 A0,0 0 0 0 747.5,173.6328 L747.5,158.5 L737.5,148.5 L580.5,148.5 A0,0 0 0 0 580.5,148.5 " fill="#DE9C0D" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M737.5,148.5 L737.5,158.5 L747.5,158.5 L737.5,148.5 " fill="#DE9C0D" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="586.5" y="165.5669">Parallel Execution Step</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="87" x="276.5" y="309"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="67" x="286.5" y="330.1387">ListSpaces</text><path d="M6,298.5 L6,353.8984 A0,0 0 0 0 6,353.8984 L256,353.8984 A0,0 0 0 0 256,353.8984 L256,330 L276.095,326 L256,322 L256,308.5 L246,298.5 L6,298.5 A0,0 0 0 0 6,298.5 " fill="#5F9EA0" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M246,298.5 L246,308.5 L256,308.5 L246,298.5 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="12" y="315.5669">Retrieves the Whitelist for Spaces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="12" y="330.6997">and "passes" them back to the step</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="12" y="345.8325">function for handoff to the handlers</text><rect fill="#DE9C0D" filter="url(#fcmp4j0j1breg)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="414" y="425"/><path d="M383.5,306 L383.5,346.2656 A0,0 0 0 0 383.5,346.2656 L450,346.2656 L454,424.796 L458,346.2656 L524.5,346.2656 A0,0 0 0 0 524.5,346.2656 L524.5,316 L514.5,306 L383.5,306 A0,0 0 0 0 383.5,306 " fill="#DE9C0D" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M514.5,306 L514.5,316 L524.5,316 L514.5,306 " fill="#DE9C0D" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="389.5" y="323.0669">Map Step - Default</text><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="97" x="389.5" y="338.1997">concurrency=3</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="122" x="260" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="102" x="270" y="508.1387">SpaceHandler_1</text><path d="M146,562 L146,693.0625 A0,0 0 0 0 146,693.0625 L496,693.0625 A0,0 0 0 0 496,693.0625 L496,572 L486,562 L325,562 L321,521.134 L317,562 L146,562 A0,0 0 0 0 146,562 " fill="#5F9EA0" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M486,562 L486,572 L496,572 L486,562 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="152" y="579.0669">Each space handler retrieves content for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="152" y="594.1997">that space, and feeds it into a specified CSV file</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="152" y="609.3325">that then gets added to an athena DB, creating the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="152" y="624.4653">"wiki_spaces"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="258" y="624.4653">table. It includes 3 links for each</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="152" y="639.5981">page:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="152" y="654.731">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="168" y="654.731">main url</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="152" y="669.8638">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="168" y="669.8638">pageID= url, and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="152" y="684.9966">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="168" y="684.9966">tinyurl</text><rect fill="#DE9C0D" filter="url(#fcmp4j0j1breg)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="657" y="623.5"/><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="122" x="402" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="102" x="412" y="508.1387">SpaceHandler_2</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="122" x="544" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="102" x="554" y="508.1387">SpaceHandler_n</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="73" x="1080.5" y="309"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="53" x="1090.5" y="330.1387">AllPages</text><path d="M1173.5,283 L1173.5,322 L1153.5,326 L1173.5,330 L1173.5,368.6641 A0,0 0 0 0 1173.5,368.6641 L1416.5,368.6641 A0,0 0 0 0 1416.5,368.6641 L1416.5,293 L1406.5,283 L1173.5,283 A0,0 0 0 0 1173.5,283 " fill="#5F9EA0" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M1406.5,283 L1406.5,293 L1416.5,293 L1406.5,283 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1179.5" y="300.0669">Looks up the number of pages in</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1179.5" y="315.1997">the overall wiki store, and divides</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1179.5" y="330.3325">it into jobs based on pagination</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="1179.5" y="345.4653">params, then passes those jobs to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1179.5" y="360.5981">the handlers to retrieve.</text><rect fill="#DE9C0D" filter="url(#fcmp4j0j1breg)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="1051" y="425"/><path d="M1436.5,306 L1436.5,346.2656 L1577.5,346.2656 L1577.5,316 L1567.5,306 L1436.5,306 " fill="#DE9C0D" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M1567.5,306 L1567.5,316 L1577.5,316 L1567.5,306 " fill="#DE9C0D" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1442.5" y="323.0669">Map Step - Default</text><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="97" x="1442.5" y="338.1997">concurrency=3</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="129" x="1026.5" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="109" x="1036.5" y="508.1387">AllPageHandler_1</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="129" x="728.5" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="109" x="738.5" y="508.1387">AllPageHandler_2</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="129" x="877.5" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="109" x="887.5" y="508.1387">AllPageHandler_n</text><path d="M788,584.5 L788,670.1641 A0,0 0 0 0 788,670.1641 L1096,670.1641 A0,0 0 0 0 1096,670.1641 L1096,594.5 L1086,584.5 L946,584.5 L942,521.134 L938,584.5 L788,584.5 A0,0 0 0 0 788,584.5 " fill="#5F9EA0" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M1086,584.5 L1086,594.5 L1096,594.5 L1086,584.5 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="794" y="601.5669">Each AllPageHandler retrieves a batch of urls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="794" y="616.6997">and feeds it into a specified CSV file</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="794" y="631.8325">(allpages/&lt;batch#&gt;.csv) that then</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="794" y="646.9653">gets added to the athena DB as the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="794" y="662.0981">"page_inventory"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="925" y="662.0981">table</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="123" x="544.5" y="309"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="103" x="554.5" y="330.1387">DegreedHandler</text><path d="M687.5,268 L687.5,322 L667.504,326 L687.5,330 L687.5,383.9297 A0,0 0 0 0 687.5,383.9297 L1060.5,383.9297 A0,0 0 0 0 1060.5,383.9297 L1060.5,278 L1050.5,268 L687.5,268 A0,0 0 0 0 687.5,268 " fill="#5F9EA0" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M1050.5,268 L1050.5,278 L1060.5,278 L1050.5,268 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="693.5" y="285.0669">Pulls all content in internal catalog, filtered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="693.5" y="300.1997">by uiurl (in conf) and puts it into a specified</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="693.5" y="315.3325">csv file (degreed/articles.csv), adding to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="693.5" y="330.4653">AthenaDB as the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="806.5" y="330.4653">"degreed_articles"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="948.5" y="330.4653">table. This may</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="293" x="693.5" y="345.5981">need to be split like the wiki calls in the future,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="307" x="693.5" y="360.731">but for now, it seems to do fine in the 15 minute</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="693.5" y="375.8638">lambda timeout.</text><rect fill="#708090" filter="url(#fcmp4j0j1breg)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="116" x="639" y="776"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="649" y="797.1387">ProcessResults</text><path d="M473.5,851 L473.5,1133.3906 A0,0 0 0 0 473.5,1133.3906 L920.5,1133.3906 A0,0 0 0 0 920.5,1133.3906 L920.5,861 L910.5,851 L701,851 L697,810.121 L693,851 L473.5,851 A0,0 0 0 0 473.5,851 " fill="#5F9EA0" filter="url(#fcmp4j0j1breg)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M910.5,851 L910.5,861 L920.5,861 L910.5,851 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="301" x="479.5" y="868.0669">Processes the results with the following ruleset:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="479.5" y="883.1997">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="495.5" y="883.1997">Check all urls in the degreed catalog against the page_inventory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="491.5" y="898.3325">table - if a page is defined in the degreed catalog, but doesn't</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="491.5" y="913.4653">appear in the page_inventory table, mark it for deletion</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="479.5" y="928.5981">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="386" x="495.5" y="928.5981">Check all urls in the degreed catalog against the wiki_spaces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="491.5" y="943.731">table. If it's in both places, override the contentID in the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="491.5" y="958.8638">wiki_spaces record with the one from the degreed catalog, and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="413" x="491.5" y="973.9966">update the record with the metadata from the wiki_spaces table.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="399" x="491.5" y="989.1294">This "updates" a record that might have been imported via the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="491.5" y="1004.2622">ui or another mechanism, maintaining integrity across pathways.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="479.5" y="1019.395">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="407" x="495.5" y="1019.395">Anything thats in the wiki_spaces table that hasn't already been</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="491.5" y="1034.5278">covered gets added as an add/update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="483.5" y="1049.6606"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="479.5" y="1064.7935">Then, it will generate the content import file, and post it to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="479.5" y="1079.9263">SFTP site.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="483.5" y="1095.0591"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="396" x="479.5" y="1110.1919">Finally, it will go back and delete all of the generated CSV files,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="479.5" y="1125.3247">prepping for the next run.</text><!--link start to Cloudwatch Timed Event--><path d="M432,28.18 C432,37.27 432,51.53 432,63.49 " fill="none" id="start-Cloudwatch Timed Event" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="432,68.79,436,59.79,432,63.79,428,59.79,432,68.79" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Cloudwatch Timed Event to Confluence to Degreed Step Function--><path d="M432,103.2 C432,113.69 432,127.46 432,138.818 " fill="none" id="Cloudwatch Timed Event-Confluence to Degreed Step Function" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="432,143.844,436,134.844,432,138.844,428,134.844,432,143.844" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Confluence to Degreed Step Function to P1--><path d="M478.629,178.079 C516.625,191.181 567.823,208.835 592.107,217.209 " fill="none" id="Confluence to Degreed Step Function-P1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="597.138,218.944,589.9342,212.228,592.4113,217.3137,587.3256,219.7908,597.138,218.944" style="stroke: #A80036; stroke-width: 1.0;"/><!--link P1 to ListSpaces--><path d="M565.955,224.099 C517.403,225.833 434.455,234.092 373,268 C357.056,276.798 343.211,292.129 333.673,304.677 " fill="none" id="P1-ListSpaces" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="330.607,308.812,339.1814,303.9664,333.5857,304.7961,332.7559,299.2004,330.607,308.812" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ListSpaces to P2--><path d="M332.519,343.083 C342.571,355.3 357.518,371.992 373,384 C395.233,401.243 425.132,415.555 441.681,422.829 " fill="none" id="ListSpaces-P2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="446.365,424.856,439.6939,417.6106,441.7762,422.8702,436.5166,424.9526,446.365,424.856" style="stroke: #A80036; stroke-width: 1.0;"/><!--link P2 to SpaceHandler_1--><path d="M444.102,433.104 C432.139,437.026 411.552,444.321 395,453 C378.076,461.875 360.295,473.793 346.406,483.768 " fill="none" id="P2-SpaceHandler_1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="342.226,486.796,351.8611,484.7554,346.2752,483.8627,347.1679,478.2767,342.226,486.796" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="396" y="464.2104">Space #1</text><!--link SpaceHandler_1 to P3--><path d="M374.55,521.085 C411.553,532.301 461.864,547.751 506,562 C572.749,583.549 652.042,610.887 683.333,621.744 " fill="none" id="SpaceHandler_1-P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="688.27,623.459,681.0795,616.7287,683.5465,621.8193,678.4559,624.2863,688.27,623.459" style="stroke: #A80036; stroke-width: 1.0;"/><!--link P2 to SpaceHandler_2--><path d="M454.387,433.137 C455.405,441.397 458.23,464.308 460.369,481.66 " fill="none" id="P2-SpaceHandler_2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="461.008,486.844,463.8775,477.4224,460.3966,481.8815,455.9375,478.4006,461.008,486.844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="460" y="464.2104">Space #2</text><!--link P2 to SpaceHandler_n--><path d="M465.181,433.068 C478.709,436.953 502.029,444.212 521,453 C540.284,461.933 560.802,474.091 576.732,484.181 " fill="none" id="P2-SpaceHandler_n" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="581.098,486.967,575.6626,478.7538,576.883,484.2774,571.3593,485.4978,581.098,486.967" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="548" y="464.2104">Space #{...}</text><!--link SpaceHandler_2 to P3--><path d="M494.073,521.134 C546.941,548.585 651.976,603.122 686.051,620.815 " fill="none" id="SpaceHandler_2-P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="690.891,623.328,684.7473,615.6303,686.4537,621.0236,681.0603,622.73,690.891,623.328" style="stroke: #A80036; stroke-width: 1.0;"/><!--link SpaceHandler_n to P3--><path d="M617.217,521.134 C637.404,547.794 676.936,600.002 691.469,619.195 " fill="none" id="SpaceHandler_n-P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="694.598,623.328,692.3552,613.7379,691.5802,619.3414,685.9767,618.5664,694.598,623.328" style="stroke: #A80036; stroke-width: 1.0;"/><!--link P1 to AllPages--><path d="M646.017,223.861 C744.885,224.132 997.962,228.754 1071,268 C1086.16,276.148 1098.15,291.618 1106.09,304.388 " fill="none" id="P1-AllPages" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1108.82,308.951,1107.6171,299.1759,1106.2465,304.6642,1100.7582,303.2935,1108.82,308.951" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AllPages to P4--><path d="M1112.82,343.227 C1107.2,365.079 1097.4,403.142 1093.11,419.799 " fill="none" id="AllPages-P4" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1091.8,424.898,1097.9181,417.1799,1093.0469,420.056,1090.1709,415.1848,1091.8,424.898" style="stroke: #A80036; stroke-width: 1.0;"/><!--link GMN16668 to P4--><path d="M1486.29,346.122 C1471.06,359.035 1449.22,375.263 1427,384 C1325.85,423.774 1195.7,429.056 1131.09,428.915 " fill="none" id="GMN16668-P4" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link P4 to AllPageHandler_1--><path d="M1091,433.137 C1091,441.397 1091,464.308 1091,481.66 " fill="none" id="P4-AllPageHandler_1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1091,486.844,1095,477.844,1091,481.844,1087,477.844,1091,486.844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="92" x="1092" y="464.2104">Grabs 1st batch</text><!--link P4 to AllPageHandler_2--><path d="M1050.7,431.982 C996.49,435.029 903.164,441.727 871,453 C851.158,459.954 831.244,472.842 816.504,483.791 " fill="none" id="P4-AllPageHandler_2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="812.488,486.821,822.0817,484.5936,816.4794,483.8096,817.2634,478.2073,812.488,486.821" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="95" x="872" y="464.2104">Grabs 2nd batch</text><!--link P4 to AllPageHandler_n--><path d="M1058.15,433.003 C1038.05,435.932 1012.36,441.694 992,453 C978.735,460.365 966.624,472.273 957.645,482.62 " fill="none" id="P4-AllPageHandler_n" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="954.239,486.644,963.1069,482.3591,957.4695,482.8277,957.0008,477.1903,954.239,486.644" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="92" x="993" y="464.2104">Grabs nth batch</text><!--link AllPageHandler_1 to P3--><path d="M1026.46,519.126 C1023.26,519.772 1020.1,520.4 1017,521 C964.097,531.252 827.177,539.969 778,562 C746.164,576.263 716.048,605.966 703.339,619.505 " fill="none" id="AllPageHandler_1-P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="699.719,623.431,708.7602,619.525,703.108,619.7548,702.8783,614.1026,699.719,623.431" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AllPageHandler_2 to P3--><path d="M780.252,521.134 C759.187,547.794 717.936,600.002 702.771,619.195 " fill="none" id="AllPageHandler_2-P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="699.506,623.328,708.2245,618.7467,702.6061,619.405,701.9478,613.7866,699.506,623.328" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AllPageHandler_n to P3--><path d="M880.324,521.036 C848.649,530.593 810.079,544.33 778,562 C747.727,578.676 717.238,606.685 703.933,619.598 " fill="none" id="AllPageHandler_n-P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="700.104,623.36,709.3275,619.9063,703.6708,619.856,703.7211,614.1994,700.104,623.36" style="stroke: #A80036; stroke-width: 1.0;"/><!--link P1 to DegreedHandler--><path d="M606,227.36 C606,239.056 606,278.629 606,303.66 " fill="none" id="P1-DegreedHandler" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="606,308.766,610,299.766,606,303.766,602,299.766,606,308.766" style="stroke: #A80036; stroke-width: 1.0;"/><!--link DegreedHandler to P3--><path d="M614.848,343.277 C629.853,371.616 660.197,432.233 676,487 C690.026,535.611 695.09,596.606 696.522,618.345 " fill="none" id="DegreedHandler-P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="696.835,623.393,700.2721,614.1633,696.5265,618.4025,692.2873,614.657,696.835,623.393" style="stroke: #A80036; stroke-width: 1.0;"/><!--link P3 to ProcessResults--><path d="M697,631.62 C697,648.69 697,731.437 697,770.935 " fill="none" id="P3-ProcessResults" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="697,775.983,701,766.983,697,770.983,693,766.983,697,775.983" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml
skinparam noteBackgroundColor cadetblue
skinparam noteBorderColor black
skinparam noteBorderThickness 0
skinparam ActivityBackgroundColor slategrey
skinparam ActivityBorderColor black
skinparam ActivityBorderThickness 0
skinparam ActivityBarColor #de9c0d
skinparam ActivityFontColor white


(*) - -> "Cloudwatch Timed Event"
- -> "Confluence to Degreed Step Function"
- -> ===P1===
note top #de9c0d
<color:#5a0dde>Parallel Execution Step</color>
end note
- -> "ListSpaces"
note left
Retrieves the Whitelist for Spaces
and "passes" them back to the step
function for handoff to the handlers
end note

- -> ===P2===
note top #de9c0d
<color:#5a0dde>Map Step - Default</color>
<color:#5a0dde>__concurrency=3__</color>
end note
- -> [Space #1] "SpaceHandler_1"
note bottom
Each space handler retrieves content for
that space, and feeds it into a specified CSV file
that then gets added to an athena DB, creating the
**"wiki_spaces"** table. It includes 3 links for each
page:
# main url
# pageID= url, and
# tinyurl
end note
- -> ===P3===
===P2===- -> [Space #2] "SpaceHandler_2"
===P2===- -> [Space #{...}] "SpaceHandler_n"

"SpaceHandler_2"- -> ===P3===
"SpaceHandler_n"- -> ===P3===


===P1=== - -> "AllPages"
note right
Looks up the number of pages in
the overall wiki store, and divides
it into jobs based on pagination
params, then passes those jobs to
the handlers to retrieve.
end note

- -> ===P4===
note top #de9c0d
<color:#5a0dde>Map Step - Default</color>
<color:#5a0dde>__concurrency=3__</color>
end note
- -> [Grabs 1st batch] "AllPageHandler_1"
===P4=== - -> [Grabs 2nd batch] "AllPageHandler_2"
===P4=== - -> [Grabs nth batch] "AllPageHandler_n"
note bottom
Each AllPageHandler retrieves a batch of urls
and feeds it into a specified CSV file
(allpages/<batch#>.csv) that then
gets added to the athena DB as the
**"page_inventory"** table
end note

AllPageHandler_1 - -> ===P3===
AllPageHandler_2 - -> ===P3===
AllPageHandler_n - -> ===P3===

===P1=== - -> "DegreedHandler"
note right
Pulls all content in internal catalog, filtered
by uiurl (in conf) and puts it into a specified
csv file (degreed/articles.csv), adding to the
AthenaDB as the **"degreed_articles"** table. This may
need to be split like the wiki calls in the future,
but for now, it seems to do fine in the 15 minute
lambda timeout.
end note

DegreedHandler- ->===P3===

- - -> "ProcessResults"
note bottom
Processes the results with the following ruleset:
# Check all urls in the degreed catalog against the page_inventory
   table - if a page is defined in the degreed catalog, but doesn't
   appear in the page_inventory table, mark it for deletion
# Check all urls in the degreed catalog against the wiki_spaces
   table. If it's in both places, override the contentID in the
   wiki_spaces record with the one from the degreed catalog, and
   update the record with the metadata from the wiki_spaces table.
   This "updates" a record that might have been imported via the
   ui or another mechanism, maintaining integrity across pathways.
# Anything thats in the wiki_spaces table that hasn't already been
   covered gets added as an add/update

Then, it will generate the content import file, and post it to the
SFTP site.

Finally, it will go back and delete all of the generated CSV files,
prepping for the next run.
end note
@enduml

PlantUML version 1.2019.06(Fri May 24 17:10:25 UTC 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>