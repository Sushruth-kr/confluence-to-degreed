<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1133px" preserveAspectRatio="none" style="width:1144px;height:1133px;" version="1.1" viewBox="0 0 1144 1133" width="1144px" zoomAndPan="magnify"><defs><filter height="300%" id="f11rplk5gymhrz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="388" cy="18" fill="#000000" filter="url(#f11rplk5gymhrz)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="171" x="302.5" y="69"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="151" x="312.5" y="90.1387">Cloudwatch Timed Event</text><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="251" x="262.5" y="144"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="231" x="272.5" y="165.1387">Confluence to Degreed Step Function</text><rect fill="#DE9C0D" filter="url(#f11rplk5gymhrz)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="521" y="219"/><path d="M533.5,148.5 L533.5,173.6328 A0,0 0 0 0 533.5,173.6328 L603.817,173.6328 L564.108,218.785 L611.817,173.6328 L704.5,173.6328 A0,0 0 0 0 704.5,173.6328 L704.5,158.5 L694.5,148.5 L533.5,148.5 A0,0 0 0 0 533.5,148.5 " fill="#DE9C0D" filter="url(#f11rplk5gymhrz)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M694.5,148.5 L694.5,158.5 L704.5,158.5 L694.5,148.5 " fill="#DE9C0D" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="539.5" y="165.5669">Parallel Execution Step</text><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="87" x="341.5" y="309"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="67" x="351.5" y="330.1387">ListSpaces</text><path d="M67,298.5 L67,353.8984 A0,0 0 0 0 67,353.8984 L321,353.8984 A0,0 0 0 0 321,353.8984 L321,330 L341.144,326 L321,322 L321,308.5 L311,298.5 L67,298.5 A0,0 0 0 0 67,298.5 " fill="#5F9EA0" filter="url(#f11rplk5gymhrz)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M311,298.5 L311,308.5 L321,308.5 L311,298.5 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="73" y="315.5669">Retrieves the Whitelist for Spaces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="73" y="330.6997">and "passes" them back to the step</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="73" y="345.8325">function for handoff to the handlers</text><rect fill="#DE9C0D" filter="url(#f11rplk5gymhrz)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="402" y="425"/><path d="M448.5,306 L448.5,346.2656 A0,0 0 0 0 448.5,346.2656 L500.961,346.2656 L444.474,424.796 L508.961,346.2656 L591.5,346.2656 A0,0 0 0 0 591.5,346.2656 L591.5,316 L581.5,306 L448.5,306 A0,0 0 0 0 448.5,306 " fill="#DE9C0D" filter="url(#f11rplk5gymhrz)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M581.5,306 L581.5,316 L591.5,316 L581.5,306 " fill="#DE9C0D" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="454.5" y="323.0669">Map Step - Default</text><text fill="#5A0DDE" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="98" x="454.5" y="338.1997">concurrency=3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="556.5" y="338.1997"/><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="120" x="242" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="100" x="252" y="508.1387">SpaceHandler_1</text><path d="M124,562 L124,632.5313 A0,0 0 0 0 124,632.5313 L480,632.5313 A0,0 0 0 0 480,632.5313 L480,572 L470,562 L306,562 L302,521.358 L298,562 L124,562 A0,0 0 0 0 124,562 " fill="#5F9EA0" filter="url(#f11rplk5gymhrz)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M470,562 L470,572 L480,572 L470,562 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="130" y="579.0669">Each space handler retrieves content for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="130" y="594.1997">that space, and feeds it into a specified CSV file</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="335" x="130" y="609.3325">that then gets added to an athena DB, creating the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="130" y="624.4653">"wiki_spaces"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="234" y="624.4653">table.</text><rect fill="#DE9C0D" filter="url(#f11rplk5gymhrz)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="510" y="593.5"/><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="120" x="382" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="100" x="392" y="508.1387">SpaceHandler_2</text><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="120" x="522" y="487"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="100" x="532" y="508.1387">SpaceHandler_n</text><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="122" x="612" y="309"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="102" x="622" y="330.1387">DegreedHandler</text><path d="M754,268 L754,322 L734.172,326 L754,330 L754,383.9297 A0,0 0 0 0 754,383.9297 L1132,383.9297 A0,0 0 0 0 1132,383.9297 L1132,278 L1122,268 L754,268 A0,0 0 0 0 754,268 " fill="#5F9EA0" filter="url(#f11rplk5gymhrz)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M1122,268 L1122,278 L1132,278 L1122,268 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="760" y="285.0669">Pulls all content in internal catalog, filtered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="760" y="300.1997">by uiurl (in conf) and puts it into a specified</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="760" y="315.3325">csv file (degreed/articles.csv), adding to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="760" y="330.4653">AthenaDB as the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="875" y="330.4653">"degreed_articles"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1018" y="330.4653">table. This may</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="760" y="345.5981">need to be split like the wiki calls in the future,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="760" y="360.731">but for now, it seems to do fine in the 15 minute</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="760" y="375.8638">lambda timeout.</text><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="149" x="475.5" y="840"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="129" x="485.5" y="861.1387">GenerateContentFile</text><path d="M644.5,716 L644.5,853 L624.757,857 L644.5,861 L644.5,998.3906 A0,0 0 0 0 644.5,998.3906 L1101.5,998.3906 A0,0 0 0 0 1101.5,998.3906 L1101.5,726 L1091.5,716 L644.5,716 A0,0 0 0 0 644.5,716 " fill="#5F9EA0" filter="url(#f11rplk5gymhrz)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M1091.5,716 L1091.5,726 L1101.5,726 L1091.5,716 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="650.5" y="733.0669">Processes the results with the following ruleset:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="650.5" y="748.1997">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="664.5" y="748.1997">Check all urls in the degreed catalog against the page_inventory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="662.5" y="763.3325">table - if a page is defined in the degreed catalog, but doesn't</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="361" x="662.5" y="778.4653">appear in the page_inventory table, mark it for deletion</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="650.5" y="793.5981">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="664.5" y="793.5981">Check all urls in the degreed catalog against the wiki_spaces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="662.5" y="808.731">table. If it's in both places, override the contentID in the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="412" x="662.5" y="823.8638">wiki_spaces record with the one from the degreed catalog, and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="662.5" y="838.9966">update the record with the metadata from the wiki_spaces table.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="409" x="662.5" y="854.1294">This "updates" a record that might have been imported via the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="662.5" y="869.2622">ui or another mechanism, maintaining integrity across pathways.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="650.5" y="884.395">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="664.5" y="884.395">Anything thats in the wiki_spaces table that hasn't already been</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="662.5" y="899.5278">covered gets added as an add/update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="654.5" y="914.6606"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="650.5" y="929.7935">Then, it will generate the content import file, and post it to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="650.5" y="944.9263">SFTP site.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="654.5" y="960.0591"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="407" x="650.5" y="975.1919">Finally, it will go back and delete all of the generated CSV files,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="650.5" y="990.3247">prepping for the next run.</text><rect fill="#708090" filter="url(#f11rplk5gymhrz)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 1.5;" width="88" x="506" y="1084"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="68" x="516" y="1105.1387">EmailNotify</text><path d="M6,1081 L6,1121.2656 A0,0 0 0 0 6,1121.2656 L486,1121.2656 A0,0 0 0 0 486,1121.2656 L486,1105 L505.62,1101 L486,1097 L486,1091 L476,1081 L6,1081 A0,0 0 0 0 6,1081 " fill="#5F9EA0" filter="url(#f11rplk5gymhrz)" style="stroke: #000000; stroke-width: 0.0;"/><path d="M476,1081 L476,1091 L486,1091 L476,1081 " fill="#5F9EA0" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="12" y="1098.0669">Notifies pathway owners (creator) via email of any wiki content in their</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="12" y="1113.1997">pathway(s) that is being deleted as a part of the run.</text><!--MD5=[80a51324b13a36c468a9a60ddf112c53]
link start to Cloudwatch Timed Event--><path d="M388,28.18 C388,37.27 388,51.53 388,63.49 " fill="none" id="start-&gt;Cloudwatch Timed Event" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="388,68.79,392,59.79,388,63.79,384,59.79,388,68.79" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[11d38250bbbb65ffda569cbe69650095]
link Cloudwatch Timed Event to Confluence to Degreed Step Function--><path d="M388,103.2 C388,113.69 388,127.463 388,138.818 " fill="none" id="Cloudwatch Timed Event-&gt;Confluence to Degreed Step Function" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="388,143.844,392,134.844,388,138.844,384,134.844,388,143.844" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[d6ea4949bf8d500e46b756b9deb82ebd]
link Confluence to Degreed Step Function to P1--><path d="M434.361,178.079 C472.139,191.181 523.042,208.835 547.187,217.209 " fill="none" id="Confluence to Degreed Step Function-&gt;P1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="552.189,218.944,544.9967,212.2157,547.4651,217.3056,542.3752,219.7739,552.189,218.944" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[bc8fddd785fc18c762e18c73338af785]
link P1 to ListSpaces--><path d="M545.553,227.035 C521.142,232.354 472.845,245.039 438,268 C423.098,277.82 409.466,292.678 399.76,304.763 " fill="none" id="P1-&gt;ListSpaces" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="396.622,308.743,405.335,304.1513,399.7173,304.8163,399.0523,299.1987,396.622,308.743" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[d1873b0ca16caee0ceaf81c56f037688]
link ListSpaces to P2--><path d="M394.158,343.227 C406.598,365.271 428.349,403.811 437.616,420.232 " fill="none" id="ListSpaces-&gt;P2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="440.249,424.898,439.3071,415.0943,437.7906,420.5441,432.3408,419.0277,440.249,424.898" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[90848c213b3bab89529cfd1da3772967]
link P2 to SpaceHandler_1--><path d="M431.444,433.05 C418.681,436.918 396.71,444.16 379,453 C361.294,461.838 342.651,473.864 328.145,483.907 " fill="none" id="P2-&gt;SpaceHandler_1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="323.781,486.954,333.4498,485.0795,327.88,484.0908,328.8687,478.521,323.781,486.954" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="380" y="464.2104">Space #1</text><!--MD5=[6558e933e8dbd4ae4651548275892b1b]
link SpaceHandler_1 to P3--><path d="M362.085,519.476 C399.616,529.426 448.521,544.065 490,562 C509.108,570.262 529.833,583.142 541.235,590.606 " fill="none" id="SpaceHandler_1-&gt;P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="545.519,593.444,540.225,585.139,541.3506,590.6827,535.8069,591.8084,545.519,593.444" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[d3db7cc0e732713181b6a2af4c37afb5]
link P2 to SpaceHandler_2--><path d="M442,433.137 C442,441.397 442,464.308 442,481.66 " fill="none" id="P2-&gt;SpaceHandler_2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="442,486.844,446,477.844,442,481.844,438,477.844,442,486.844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="443" y="464.2104">Space #2</text><!--MD5=[5e37b870f576a4c1db9a5d9979a28a19]
link P2 to SpaceHandler_n--><path d="M452.556,433.05 C465.319,436.918 487.29,444.16 505,453 C522.706,461.838 541.349,473.864 555.855,483.907 " fill="none" id="P2-&gt;SpaceHandler_n" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="560.219,486.954,555.1313,478.521,556.12,484.0908,550.5502,485.0795,560.219,486.954" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="530" y="464.2104">Space #{...}</text><!--MD5=[0f90ef436ef03df9561c984445188b03]
link SpaceHandler_2 to P3--><path d="M461.06,521.148 C485.193,541.594 525.643,575.865 542.387,590.05 " fill="none" id="SpaceHandler_2-&gt;P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="546.448,593.491,542.165,584.6222,542.6324,590.2597,536.9949,590.7271,546.448,593.491" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8e382dfd7ca975fea0b5e763f82d55ec]
link SpaceHandler_n to P3--><path d="M576.279,521.358 C569.423,540.962 558.2,573.053 552.92,588.151 " fill="none" id="SpaceHandler_n-&gt;P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="551.155,593.196,557.9009,586.0201,552.805,588.4761,550.349,583.3802,551.155,593.196" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[0c5599764c46f07b9bfe69092d211561]
link P1 to DegreedHandler--><path d="M564.726,227.36 C577.967,239.301 623.428,280.296 651.056,305.212 " fill="none" id="P1-&gt;DegreedHandler" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="654.997,308.766,650.9909,299.7687,651.2834,305.418,645.6341,305.7105,654.997,308.766" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e353addca6293d11307364a7440cb2eb]
link DegreedHandler to P3--><path d="M675.361,343.136 C679.654,378.157 685.455,462.666 652,521 C631.097,557.448 584.731,581.492 562.44,591.385 " fill="none" id="DegreedHandler-&gt;P3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="557.569,593.49,567.4173,593.5903,562.1585,591.5059,564.2428,586.2471,557.569,593.49" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[7ed84a3e0c816513efc88d219eb6c05a]
link P3 to GenerateContentFile--><path d="M550,601.756 C550,625.895 550,777.671 550,834.529 " fill="none" id="P3-&gt;GenerateContentFile" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="550,839.727,554,830.727,550,834.727,546,830.727,550,839.727" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[860f9eea6af434b08d68406bc2ddc826]
link GenerateContentFile to EmailNotify--><path d="M550,874.254 C550,916.704 550,1030.9047 550,1078.6058 " fill="none" id="GenerateContentFile-&gt;EmailNotify" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="550,1083.8167,554,1074.8167,550,1078.8167,546,1074.8167,550,1083.8167" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[31c6f9d1b1bc40f3b2c6b363f48ac8ab]
@startuml
skinparam noteBackgroundColor cadetblue
skinparam noteBorderColor black
skinparam noteBorderThickness 0
skinparam ActivityBackgroundColor slategrey
skinparam ActivityBorderColor black
skinparam ActivityBorderThickness 0
skinparam ActivityBarColor #de9c0d
skinparam ActivityFontColor white


(*) - -> "Cloudwatch Timed Event"
- -> "Confluence to Degreed Step Function"
- -> ===P1===
note top #de9c0d
<color:#5a0dde>Parallel Execution Step</color>
end note
- -> "ListSpaces"
note left
Retrieves the Whitelist for Spaces
and "passes" them back to the step
function for handoff to the handlers
end note

- -> ===P2===
note top #de9c0d
<color:#5a0dde>Map Step - Default</color>
<color:#5a0dde>__concurrency=3__</color> 
end note
- -> [Space #1] "SpaceHandler_1"
note bottom
Each space handler retrieves content for 
that space, and feeds it into a specified CSV file
that then gets added to an athena DB, creating the
**"wiki_spaces"** table. 
end note
- -> ===P3===
===P2===- -> [Space #2] "SpaceHandler_2"
===P2===- -> [Space #{...}] "SpaceHandler_n"

"SpaceHandler_2"- -> ===P3===
"SpaceHandler_n"- -> ===P3===



===P1=== - -> "DegreedHandler"
note right
Pulls all content in internal catalog, filtered
by uiurl (in conf) and puts it into a specified 
csv file (degreed/articles.csv), adding to the 
AthenaDB as the **"degreed_articles"** table. This may
need to be split like the wiki calls in the future, 
but for now, it seems to do fine in the 15 minute
lambda timeout.
end note

DegreedHandler- ->===P3===

- - -> "GenerateContentFile"
note right
Processes the results with the following ruleset:
# Check all urls in the degreed catalog against the page_inventory 
   table - if a page is defined in the degreed catalog, but doesn't 
   appear in the page_inventory table, mark it for deletion
# Check all urls in the degreed catalog against the wiki_spaces
   table. If it's in both places, override the contentID in the 
   wiki_spaces record with the one from the degreed catalog, and 
   update the record with the metadata from the wiki_spaces table.
   This "updates" a record that might have been imported via the
   ui or another mechanism, maintaining integrity across pathways.
# Anything thats in the wiki_spaces table that hasn't already been
   covered gets added as an add/update

Then, it will generate the content import file, and post it to the 
SFTP site.

Finally, it will go back and delete all of the generated CSV files,
prepping for the next run. 
end note

- - -> "EmailNotify"
note left
Notifies pathway owners (creator) via email of any wiki content in their
pathway(s) that is being deleted as a part of the run.
end note
@enduml

PlantUML version 1.2020.00(Sat Jan 11 12:30:53 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.7.0_231-mockbuild_2019_08_02_17_36-b00
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>